!function(){"use strict";let e=[{key:"attackStart",type:"range",value:[.25,.7],range:[0,1],step:.05},{key:"attackStep",type:"range",value:[-.2,.2],range:[-1,1],step:.05},{key:"restChance",type:"range",value:[0,0],range:[0,1],step:.01},{key:"loopNums",type:"range",value:[1,1,.1,.2],range:[1,32],step:1},{key:"harmonyChance",type:"chance",value:.6},{key:"harmonyList",type:"list",value:[4,5]},{key:"harmonyStart",type:"list",value:[4,5]},{key:"harmonyAdd",type:"list",value:[2,3,6,7],shuffle:!0},{key:"harmonyUpdateChance",type:"chance",value:.2},{key:"startIndexes",type:"range",value:[0,0,0,.3],range:[0,0],step:1},{key:"indexStep",type:"range",value:[0,0,-.2,.2],range:[0,8,-1,1],step:1},{key:"durationStart",type:"list",value:[2,4]},{key:"durationAdd",type:"list",value:[1,8,16,32],shuffle:!0},{key:"durationChance",type:"chance",value:.3},{key:"startDelaysStart",type:"list",value:[0,1,2,4,.5,8]},{key:"startDelaysAdd",type:"list",value:[12,16,3,5,7,11],shuffle:!0},{key:"startDelaysChance",type:"chance",value:.3},{key:"sliceChance",type:"chance",value:.1},{key:"sliceLength",type:"number",value:3,range:[1,8]},{key:"shiftChance",type:"chance",value:.2},{key:"shiftLength",type:"number",value:16,range:[0,32]},{key:"doublerChance",type:"chance",value:.5},{key:"doublerCounterChance",type:"chance",value:.4},{key:"repeat",type:"list",value:[2,3,4]},{key:"startLoops",type:"loops",value:[[{}]]},{key:"fxLimit",type:"number",value:1,range:[0,16]},{key:"fxKickIn",type:"number",value:8,range:[0,64]},{key:"reverbChance",type:"chance",value:1},{key:"reverbDecay",type:"number",value:5,range:[.5,32],step:.1},{key:"distortionChance",type:"chance",value:.25},{key:"distortion",type:"range",value:[.05,.2],range:[.01,1],step:.01},{key:"bitCrushChance",type:"chance",value:.25},{key:"bitCrushBits",type:"list",value:[3,4,6,8,12,16]},{key:"autoFilterChance",type:"chance",value:.25},{key:"autoFilterFrequency",type:"list",value:["2n","4n","8n","16n","32n"]},{key:"autoPannerChance",type:"chance",value:.25},{key:"autoPannerFrequency",type:"list",value:["2n","4n","8n","16n","32n"]},{key:"chebyChance",type:"chance",value:.25},{key:"chebyOrder",type:"number",value:16,range:[1,100]},{key:"chorusChance",type:"chance",value:.25},{key:"chorusFrequency",type:"number",value:4,range:[1,12]},{key:"chorusDelayTime",type:"number",value:2.5,range:[.1,12],step:.1},{key:"chorusDepth",type:"number",value:.5,range:[0,1]},{key:"feedbackChance",type:"chance",value:.25},{key:"feedbackDelayTime",type:"list",value:["8n","4n","16n","32n"]},{key:"feedback",type:"number",value:.25,range:[.1,1],step:.01},{key:"phaserChance",type:"chance",value:.25},{key:"phaserFrequency",type:"number",value:15,range:[0,32]},{key:"phaserOctaves",type:"number",value:5,range:[1,16]},{key:"phaserBaseFrequency",type:"number",value:1e3,range:[1,1e4]},{key:"pingPongChance",type:"chance",value:.25},{key:"pingPongDelayTime",type:"list",value:["1n","2n","4n","8n","16n","32n","2t","4t","8t","16t","32t"]},{key:"pingPongFeedback",type:"number",value:.25,range:[0,1],step:.01},{key:"tremoloChance",type:"chance",value:.25},{key:"tremoloFrequency",type:"range",value:[9,9],range:[1,18],step:1},{key:"tremoloDepth",type:"range",value:[.1,.5],range:[0,1],step:.05},{key:"vibratoChance",type:"chance",value:.25},{key:"vibratoFrequency",type:"range",value:[9,9],range:[1,18],step:1},{key:"vibratoDepth",type:"range",value:[.1,.5],range:[0,1],step:.05}],t={};function n(e){const t={distortion:()=>{const t=u(...e.distortion);return new Tone.Distortion(t)},bitCrush:()=>{const t=u(e.bitCrushBits);return new Tone.BitCrusher(t)},autoFilter:()=>{const t=u(e.autoFilterFrequency);return new Tone.AutoFilter(t).start()},autoPanner:()=>{const t=u(e.autoPannerFrequency);return new Tone.AutoPanner(t).start()},cheby:()=>{const t=p(e.chebyOrder);return new Tone.Chebyshev(t)},chorus:()=>{const t=p(e.chorusFrequency),n=u(e.chorusDelayTime),o=u(e.chorusDepth);return new Tone.Chorus(t,n,o).start()},feedback:()=>{const t=u(e.feedback),n=u(e.feedbackDelayTime);return new Tone.FeedbackDelay(n,t)},phaser:()=>{const t=p(e.phaserFrequency),n=p(e.phaserOctaves),o=p(e.phaserBaseFrequency);return new Tone.Phaser(t,n,o)},tremolo:()=>{const t=p(...e.tremoloFrequency),n=u(...e.tremoloDepth);return new Tone.Tremolo(t,n).start()},pingPong:()=>{const t=u(e.pingPongDelayTime),n=u(e.pingPongFeedback);return new Tone.PingPongDelay(t,n)},vibrato:()=>{const t=p(...e.vibratoFrequency),n=u(e.vibratoDepth);return new Tone.Vibrato(t,n)}};function n(t,n,o){return l(e[t+"Chance"])&&n>=o}return{get:function(o,a){let r=[];if(n("reverb",o,0)){const t=new Tone.Reverb({decay:"toms"===a?.5:e.reverbDecay});r.push(t)}let s=Object.keys(t).filter((t=>n(t,o,e.fxKickIn)));return s=c(s).slice(0,e.fxLimit).map((e=>t[e]())),[...r,...s]}}}e.forEach((e=>{const{key:n,value:o,type:a}=e;switch(a){case"range":case"chance":case"number":case"loops":t[n]=o;break;case"list":t[n]=e.shuffle?c(o):o}})),window.DoodooControls={defaults:t,controls:e},window.Doodoo=function(e,p){let c,m=e.debug,y=!1,h=e.duration||"4n",d=e.scale||[0,2,4,5,7,9,11],g=void 0===e.autoStart||e.autoStart,f=void 0===e.autoLoad||e.autoStart,A=e.voices||[e.samples];0===A.length&&A.push("FMSynth");let D,H=e.withRecording,E=e.withCount;H&&(D=new Tone.Recorder,E||(E=+prompt("Record number of mutations?",10)));let v="string"==typeof e.tonic?e.tonic:o[e.tonic];e.transform||(e.transform=e.tonic);let b="string"==typeof e.transform?e.transform:o[e.transform],k={...t,...e.controls},F=new n(k),I=[];if("string"==typeof e.parts[0]){const t=e.parts.map((e=>[e,h]));I.push(new s(t,k,h,m))}else if("number"==typeof e.parts[0]){const t=e.parts.map((e=>[o[e],h]));I.push(new s(t,k,h,m))}else if(Array.isArray(e.parts[0]))if(Array.isArray(e.parts[0][0]))for(let t=0;t<e.parts.length;t++){const n=e.parts[t];I.push(new s(n,k,h,m));const o=e.parts[t].map((e=>parseInt(e[1])));h=Math.max(...o)+"n"}else{const t=e.parts;I.push(new s(t,k,h,m));const n=e.parts.map((e=>parseInt(e[1])));h=Math.max(...n)+"n"}let O=0,T=0,G=e.simultaneous||!1;const U=new C(...k.attackStart),B=new C(...k.attackStep),w=new C(...k.restChance);let M,x=[],S=0,R=0;const L=e.useMetro;let $;async function P(){try{await Tone.start(),_?function(t){let n=function(){let e={};return A.forEach((t=>{if("choir"===t)"AEIOU".split("").forEach((n=>{const o=i["choir"+n];for(const a in o)e[`${t}-${n}-${a}`]=`${t}/${n}/${o[a]}`}));else for(const n in i[t])e[`${t}-${n}`]=`${t}/${i[t][n]}`})),e}();console.time(`load ${A.join(", ")}`),c=new Tone.ToneAudioBuffers({urls:n,baseUrl:e.samplesURL||"../samples/",onload:()=>{console.timeEnd(`load ${A.join(", ")}`),t&&t(),q=!0}})}(N):N()}catch(e){console.error("load tone error",e)}}let _=A.some((e=>!e.includes("Synth"))),q=!1,j=!1;function N(){p&&p(),M=new Tone.Loop(Q,h),Tone.Transport.start(),e.bpm&&(Tone.Transport.bpm.value=e.bpm),M.start(Tone.Transport.seconds),(g||j)&&K(),L&&($=new Tone.MetalSynth({volume:-12,frequency:250,envelope:{attack:.01,decay:.01,release:.2},harmonicity:3.1,modulationIndex:32,resonance:4e3,octaves:1.5}).toDestination()),y=!0,H&&D.start()}function K(){R=0,x=[];let t=G?I:[I[O]];t.forEach((e=>{e.getLoops().forEach((e=>{const t={...e,melody:0===e.harmony?a(e.melody,v,b):r(e.melody,v,b,e.harmony,d),voice:V(e.voice||u(A))};x.push(t)}))})),x.forEach((e=>{let t=[];e.melody.forEach((e=>{const[n,o]=e;let a=+h.slice(0,-1)/+o.slice(0,-1);o.includes(".")&&(a*=1.5),t.push(e);for(let e=1;e<a;e++)t.push([null,h])})),e.melody=t,e.countNum=e.doubler?e.counter*e.noteDuration/4:1,e.countEnd=(e.melody.length-1)*e.repeat+e.startDelay,e.len=e.melody.length})),S=Math.max(0,Math.max(...x.map((e=>e.melody.length))));let n=t.map((e=>e.update()))[0];e.onMutate&&e.onMutate(n),G||(O++,O>=I.length&&(O=0)),T++,"stopped"===Tone.Transport.state&&Tone.Transport.start(),E&&n>E&&(Tone.Transport.stop(),y=!1,D&&z())}function Q(e){L&&$.triggerAttackRelease("C4","4n",e,.1);let t=U.getRandom();for(let n=0;n<x.length;n++){const o=x[n];if(!(o.count>o.countEnd)){for(let n=0;n<o.countNum;n++){if(o.count<o.startDelay)continue;if(o.count%1!=0&&!o.doubler)continue;if(l(w.getRandom()))continue;const a=o.melody[Math.floor(o.count-o.startDelay+o.startIndex)%o.len];if(null!==a[0]){const[r,s]=a;let u=n?Tone.Time(`${o.noteDuration}n`).toSeconds()*n:0;o.voice.triggerAttackRelease(r,s,e+u,t)}o.doublerCounter&&(o.count+=o.counter)}(!o.doublerCounter||o.count<o.startDelay)&&(o.count+=o.counter)}}var n,o,a;t+=B.getRandom(),n=t,o=.1,a=1,t=Math.min(Math.max(n,o),a),R++,R===S&&K()}function V(t){return t.includes("Synth")?function(){const t=new Tone.FMSynth({volume:e.volume||0});H?t.chain(Tone.Destination,D):t.toDestination();return F.get(T).forEach((e=>{H?e.chain(Tone.Destination,D):e.toDestination(),t.connect(e)})),t}():function(t){const n=function(e){const t={};if("choir"===e){const n=T<3?"U":u("AEIOU".split(""));for(const o in i[e+n])t[o]=c.get(`${e}-${n}-${o}`)}else for(const n in i[e])t[n]=c.get(`${e}-${n}`);return t}(t),o=new Tone.Sampler({urls:n,volume:e.volume||0,release:1});H?o.chain(Tone.Destination,D):o.toDestination();return F.get(T,t).forEach((e=>{H?e.chain(Tone.Destination,D):e.toDestination(),o.connect(e)})),o}(t)}async function z(){const t=await D.stop(),n=URL.createObjectURL(t),o=document.createElement("a"),a=prompt("Name clip",e.title||"Doodoo_"+(new Date).toDateString().replace(/ /g,"-"));o.download=a+".webm",o.href=n,o.click()}return f&&P(),{play:function(){if(!f)return P();!_||q?(K(),M.start(Tone.Transport.seconds),y=!0,H&&D.start()):j=!0},stop:function(){Tone.Transport.stop(),M.stop(),y=!1,H&&"started"===D.state&&z()},mutate:function(){I.forEach((e=>{e.update()}))},moveTonic:function(e){let t=o.indexOf(b)+e;b=o[t]},setTonic:function(e){b=e},moveBPM:function(e){let t=Tone.Transport.bpm.value;Tone.Transport.bpm.value=t+e},setBPM:function(e){Tone.Transport.bpm.value=e},getIsPlaying:function(){return y},isRecording:function(){return!!D&&("started"===D.state||"paused"===D.state)},printLoops:function(){console.log("loops",x)},getLoops:function(){return x}}};const o=["C_1","C#_1","D_1","D#_1","E_1","F_1","F#_1","G_1","G#_1","A_1","A#_1","B_1","C0","C#0","D0","D#0","E0","F0","F#0","G0","G#0","A0","A#0","B0","C1","C#1","D1","D#1","E1","F1","F#1","G1","G#1","A1","A#1","B1","C2","C#2","D2","D#2","E2","F2","F#2","G2","G#2","A2","A#2","B2","C3","C#3","D3","D#3","E3","F3","F#3","G3","G#3","A3","A#3","B3","C4","C#4","D4","D#4","E4","F4","F#4","G4","G#4","A4","A#4","B4","C5","C#5","D5","D#5","E5","F5","F#5","G5","G#5","A5","A#5","B5","C6","C#6","D6","D#6","E6","F6","F#6","G6","G#6","A6","A#6","B6","C7","C#7","D7","D#7","E7","F7","F#7","G7","G#7","A7","A#7","B7","C8","C#8","D8","D#8","E8","F8","F#8","G8","G#8","A8","A#8","B8","C9","C#9","D9","D#9","E9","F9","F#9","G9"];function a(e,t,n,a){return e.map((e=>{if(null===e[0])return e;{const[a,r]=e,s=o.indexOf(t)-o.indexOf(n),u=o.indexOf(a)-s;return[o[u],r]}}))}function r(e,t,n,a,r){return e.map((e=>{if(null===e[0])return e;{const[s,u]=e,p=o.indexOf(s),c=o.indexOf(t),l=c-o.indexOf(n),i=p-c,m=i<0?r.indexOf(12-Math.abs(i)%12):r.indexOf(i%12);let C=r[(m+a-1)%r.length];-1===m&&(C=0);let y=12*Math.floor(Math.abs(i)/12)*Math.sign(i),h=o.indexOf(t)+C+y-l;return[o[h],u]}}))}function s(e,t,n,o){let a=0;const r=new C(...t.loopNums),s=new m(t.harmonyStart,t.harmonyAdd,t.harmonyUpdateChance),c=new C(...t.startIndexes),i=new C(...t.indexStep),y=new m(t.durationStart,t.durationAdd,t.durationsChance),h=new m(t.startDelaysStart,t.startDelaysAdd,t.startDelaysChance),d={noteDuration:n,count:0,counter:1,doubler:!1,doublerCounter:!1,repeat:1,startIndex:0,startDelay:0,harmony:0,melody:e},g=t.startLoops.map((e=>e.map((e=>({...d,...e})))));return{update:function(){return function(){if(r.update(),l(t.sliceChance)){let n=p(e.length),o=e.slice(n,n+p(1,t.sliceLength));e.push(...o)}l(t.shiftChance)&&e.length>t.shiftLength&&e.shift(),a++,o&&console.log(`${a} mutations`)}(),a},getLoops:function(){if(g[a])return g[a];const n=[],o=r.getRandInt();let p=c.getRandInt(),m=0;console.log("loops",o,r.getRange());for(let a=0;a<o;a++){let o=y.getRandom();n.push({noteDuration:o,count:0,counter:o<4?o/4:1,doubler:o>4&&o<32&&l(t.doublerChance),doublerCounter:o>4&&l(t.doublerCounterChance),repeat:o>9?u([...t.repeat]):1,startIndex:p,startDelay:m,melody:e,harmony:l(t.harmonyChance)?s.getRandom():0}),p=Math.max(0,u([p,p+i.getMin(),p+i.getMax()])),m=h.getRandom()}return n},getTestLoops:function(){return[{noteDuration:4,count:0,counter:1,doubler:!1,doublerCounter:!1,repeat:1,startIndex:0,startDelay:0,melody:e,harmony:0},{noteDuration:4,count:0,counter:1,doubler:!1,doublerCounter:!1,repeat:1,startIndex:0,startDelay:0,melody:e,harmony:4}]}}}function u(e,t){return t?Math.random()*(t-e)+e:"number"==typeof e?Math.random()*e:Array.isArray(e)?e[Math.floor(Math.random()*e.length)]:"object"==typeof e?e[u(Object.keys(e))]:void 0}function p(e,t){return t||(t=e,e=0),Math.round(Math.random()*(t-e)+e)}function c(e){let t,n,o=e.length;for(;0!==o;)n=Math.floor(Math.random()*o),o-=1,t=e[o],e[o]=e[n],e[n]=t;return e}function l(e){return u(1)<e}window.DoodooMidi={MIDI_NOTES:o};let i={bamboo:{B3:"b3.ogg",G4:"g4.ogg"},flute:{C5:"C5.wav"},guitar:{C4:"C4.wav"},strings:{"A#2":"Ash2.ogg",A5:"A5.ogg",C4:"C4.ogg",C7:"C7.ogg","D#2":"Dsh2.ogg",D5:"D5.ogg",E3:"E3.ogg",E6:"E6.ogg",G4:"G4.ogg"},toms:{"A#3":"Tom606_EQ_FADE.ogg"},choirA:{A2:"CH-AA-A2.mp3",A3:"CH-AA-A3.mp3",A4:"CH-AA-A4.mp3",B2:"CH-AA-B2.mp3",B3:"CH-AA-B3.mp3",B4:"CH-AA-B4.mp3",C2:"CH-AA-C2.mp3",C3:"CH-AA-C3.mp3",C4:"CH-AA-C4.mp3",C5:"CH-AA-C5.mp3",D2:"CH-AA-D2.mp3",D3:"CH-AA-D3.mp3",D4:"CH-AA-D4.mp3",E2:"CH-AA-E2.mp3",E3:"CH-AA-E3.mp3",E4:"CH-AA-E4.mp3",F2:"CH-AA-F2.mp3",F3:"CH-AA-F3.mp3",F4:"CH-AA-F4.mp3",G2:"CH-AA-G2.mp3",G3:"CH-AA-G3.mp3",G4:"CH-AA-G4.mp3"},choirE:{A2:"CH-EE-A2.mp3",A3:"CH-EE-A3.mp3",A4:"CH-EE-A4.mp3",B2:"CH-EE-B2.mp3",B3:"CH-EE-B3.mp3",B4:"CH-EE-B4.mp3",C2:"CH-EE-C2.mp3",C3:"CH-EE-C3.mp3",C4:"CH-EE-C4.mp3",C5:"CH-EE-C5.mp3",D2:"CH-EE-D2.mp3",D3:"CH-EE-D3.mp3",D4:"CH-EE-D4.mp3",E2:"CH-EE-E2.mp3",E3:"CH-EE-E3.mp3",E4:"CH-EE-E4.mp3",F2:"CH-EE-F2.mp3",F3:"CH-EE-F3.mp3",F4:"CH-EE-F4.mp3",G2:"CH-EE-G2.mp3",G3:"CH-EE-G3.mp3",G4:"CH-EE-G4.mp3"},choirI:{A2:"CH-II-A2.mp3",A3:"CH-II-A3.mp3",A4:"CH-II-A4.mp3",B2:"CH-II-B2.mp3",B3:"CH-II-B3.mp3",B4:"CH-II-B4.mp3",C2:"CH-II-C2.mp3",C3:"CH-II-C3.mp3",C4:"CH-II-C4.mp3",C5:"CH-II-C5.mp3",D2:"CH-II-D2.mp3",D3:"CH-II-D3.mp3",D4:"CH-II-D4.mp3",E2:"CH-II-E2.mp3",E3:"CH-II-E3.mp3",E4:"CH-II-E4.mp3",F2:"CH-II-F2.mp3",F3:"CH-II-F3.mp3",F4:"CH-II-F4.mp3",G2:"CH-II-G2.mp3",G3:"CH-II-G3.mp3",G4:"CH-II-G4.mp3"},choirO:{A2:"CH-OO-A2.mp3",A3:"CH-OO-A3.mp3",A4:"CH-OO-A4.mp3",B2:"CH-OO-B2.mp3",B3:"CH-OO-B3.mp3",B4:"CH-OO-B4.mp3",C2:"CH-OO-C2.mp3",C3:"CH-OO-C3.mp3",C4:"CH-OO-C4.mp3",C5:"CH-OO-C5.mp3",D2:"CH-OO-D2.mp3",D3:"CH-OO-D3.mp3",D4:"CH-OO-D4.mp3",E2:"CH-OO-E2.mp3",E3:"CH-OO-E3.mp3",E4:"CH-OO-E4.mp3",F2:"CH-OO-F2.mp3",F3:"CH-OO-F3.mp3",F4:"CH-OO-F4.mp3",G2:"CH-OO-G2.mp3",G3:"CH-OO-G3.mp3",G4:"CH-OO-G4.mp3"},choirU:{A2:"CH-UU-A2.mp3",A3:"CH-UU-A3.mp3",A4:"CH-UU-A4.mp3",B2:"CH-UU-B2.mp3",B3:"CH-UU-B3.mp3",B4:"CH-UU-B4.mp3",C2:"CH-UU-C2.mp3",C3:"CH-UU-C3.mp3",C4:"CH-UU-C4.mp3",C5:"CH-UU-C5.mp3",D2:"CH-UU-D2.mp3",D3:"CH-UU-D3.mp3",D4:"CH-UU-D4.mp3",E2:"CH-UU-E2.mp3",E3:"CH-UU-E3.mp3",E4:"CH-UU-E4.mp3",F2:"CH-UU-F2.mp3",F3:"CH-UU-F3.mp3",F4:"CH-UU-F4.mp3",G2:"CH-UU-G2.mp3",G3:"CH-UU-G3.mp3",G4:"CH-UU-G4.mp3"}};function m(e,t,n){void 0===n&&(n=.5);let o=[...e];return{update:()=>{0!==t.length&&l(n)&&o.push(t.pop())},add:e=>{o.push(e)},getRandom:()=>u(o)}}function C(e,t,n,o){return console.log(e,t,n,o),{update:function(){l(Math.abs(n))&&e+Math.sign(n)<t&&(e+=Math.sign(n)),l(Math.abs(o))&&(t+=Math.sign(o))},getRange:()=>[e,t],getRandom:()=>u(e,t),getRandInt:()=>p(e,t),getMin:()=>e,getMax:()=>t}}}();
//# sourceMappingURL=src_maps/doodoo.min.js.map
