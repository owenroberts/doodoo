!function(){"use strict";let e=[{key:"voiceAttack",type:"range",value:[.1,.5,0,0],range:[0,1],step:.1},{key:"voiceRelease",type:"range",value:[.1,.5,0,0],range:[0,1],step:.1},{key:"voiceCurve",type:"list",value:["linear","exponential","sine","cosine","bounce","ripple","step"]},{key:"voiceCurveIndex",type:"number",value:1},{key:"voiceCurveUpdateChance",type:"chance",value:.1},{key:"attackStart",type:"range",value:[.25,.7],range:[0,1],step:.05},{key:"attackStep",type:"walker",value:[.5,.01,.75,.1,1,0],step:.01},{key:"restChance",type:"range",value:[0,0,0,0],range:[0,1],step:.01},{key:"loopNums",type:"range",value:[1,1,.1,.2],range:[1,32],step:1},{key:"maxLoops",type:"number",value:5},{key:"harmonyChance",type:"walker",value:[.6,.01,.5,0,1,0],range:[0,1],step:.01},{key:"harmonyList",type:"list",value:[4,5,2,3,6,7]},{key:"harmonyIndex",type:"number",value:2},{key:"harmonyUpdateChance",type:"chance",value:.2},{key:"startIndexes",type:"range",value:[0,0,0,.3],range:[0,0],step:1},{key:"indexStep",type:"walker",value:[0,.1,.75,0,8,0],step:.1},{key:"durationList",type:"list",value:[2,4,1,8,16,32]},{key:"durationIndex",type:"number",value:2},{key:"durationChance",type:"chance",value:.3},{key:"startDelayList",type:"list",value:[0,1,2,4,.5,8,12,16,3,5,7,11]},{key:"startDelayIndex",type:"number",value:6},{key:"startDelayChance",type:"chance",value:.3},{key:"voiceList",type:"list",value:[]},{key:"voiceIndex",type:"number",value:0},{key:"voiceChance",type:"chance",value:.1},{key:"sliceChance",type:"chance",value:.1},{key:"sliceLength",type:"range",value:[1,3,0,0],range:[1,8]},{key:"shiftChance",type:"chance",value:.2},{key:"shiftLength",type:"number",value:16,range:[0,32]},{key:"doublerChance",type:"chance",value:.5},{key:"repeat",type:"list",value:[2,3,4]},{key:"startLoops",type:"loops",value:[[{}]]},{key:"fxLimit",type:"number",value:1,range:[0,16]},{key:"fxKickIn",type:"number",value:8,range:[0,64]},{key:"reverbChance",type:"chance",value:1},{key:"reverbDecay",type:"number",value:5,range:[.5,32],step:.1},{key:"distortionChance",type:"chance",value:.25},{key:"distortion",type:"range",value:[.05,.2],range:[.01,1],step:.01},{key:"bitCrushChance",type:"chance",value:.25},{key:"bitCrushBits",type:"list",value:[3,4,6,8,12,16]},{key:"autoFilterChance",type:"chance",value:.25},{key:"autoFilterFrequency",type:"list",value:["2n","4n","8n","16n","32n"]},{key:"autoPannerChance",type:"chance",value:.25},{key:"autoPannerFrequency",type:"list",value:["2n","4n","8n","16n","32n"]},{key:"chebyChance",type:"chance",value:.25},{key:"chebyOrder",type:"number",value:16,range:[1,100]},{key:"chorusChance",type:"chance",value:.25},{key:"chorusFrequency",type:"number",value:4,range:[1,12]},{key:"chorusDelayTime",type:"number",value:2.5,range:[.1,12],step:.1},{key:"chorusDepth",type:"number",value:.5,range:[0,1]},{key:"feedbackChance",type:"chance",value:.25},{key:"feedbackDelayTime",type:"list",value:["8n","4n","16n","32n"]},{key:"feedback",type:"number",value:.25,range:[.1,1],step:.01},{key:"phaserChance",type:"chance",value:.25},{key:"phaserFrequency",type:"number",value:15,range:[0,32]},{key:"phaserOctaves",type:"number",value:5,range:[1,16]},{key:"phaserBaseFrequency",type:"number",value:1e3,range:[1,1e4]},{key:"pingPongChance",type:"chance",value:.25},{key:"pingPongDelayTime",type:"list",value:["1n","2n","4n","8n","16n","32n","2t","4t","8t","16t","32t"]},{key:"pingPongFeedback",type:"number",value:.25,range:[0,1],step:.01},{key:"tremoloChance",type:"chance",value:.25},{key:"tremoloFrequency",type:"range",value:[9,9],range:[1,18],step:1},{key:"tremoloDepth",type:"range",value:[.1,.5],range:[0,1],step:.05},{key:"vibratoChance",type:"chance",value:.25},{key:"vibratoFrequency",type:"range",value:[9,9],range:[1,18],step:1},{key:"vibratoDepth",type:"range",value:[.1,.5],range:[0,1],step:.05}],t={};function n(e){const t={distortion:()=>{const t=m(...e.distortion);return new Tone.Distortion(t)},bitCrush:()=>{const t=m(e.bitCrushBits);return new Tone.BitCrusher(t)},autoFilter:()=>{const t=m(e.autoFilterFrequency);return new Tone.AutoFilter(t).start()},autoPanner:()=>{const t=m(e.autoPannerFrequency);return new Tone.AutoPanner(t).start()},cheby:()=>{const t=h(e.chebyOrder);return new Tone.Chebyshev(t)},chorus:()=>{const t=h(e.chorusFrequency),n=m(e.chorusDelayTime),o=m(e.chorusDepth);return new Tone.Chorus(t,n,o).start()},feedback:()=>{const t=m(e.feedback),n=m(e.feedbackDelayTime);return new Tone.FeedbackDelay(n,t)},phaser:()=>{const t=h(e.phaserFrequency),n=h(e.phaserOctaves),o=h(e.phaserBaseFrequency);return new Tone.Phaser(t,n,o)},tremolo:()=>{const t=h(...e.tremoloFrequency),n=m(...e.tremoloDepth);return new Tone.Tremolo(t,n).start()},pingPong:()=>{const t=m(e.pingPongDelayTime),n=m(e.pingPongFeedback);return new Tone.PingPongDelay(t,n)},vibrato:()=>{const t=h(...e.vibratoFrequency),n=m(e.vibratoDepth);return new Tone.Vibrato(t,n)}};function n(t,n,o){return C(e[t+"Chance"])&&n>=o}return{get:function(o,a){let r=[];if(n("reverb",o,0)){const t=new Tone.Reverb({decay:"toms"===a?.5:e.reverbDecay});r.push(t)}let s=Object.keys(t).filter((t=>n(t,o,e.fxKickIn)));return s=y(s).slice(0,e.fxLimit).map((e=>t[e]())),[...r,...s]}}}e.forEach((e=>{const{key:n,value:o,type:a}=e;switch(a){case"range":case"chance":case"number":case"loops":case"walker":t[n]=o;break;case"list":t[n]=e.shuffle?y(o):o}})),window.DoodooControls={defaults:t,controls:e},window.Doodoo=function(e,a){let r,l,u=e.debug,p=!1,h=e.duration??"4n",y=e.scale??[0,2,4,5,7,9,11],v=e.autoStart??!0,f=e.autoLoad??!0,k=e.useOctave??!1,A=e.sequence??[[!0]],E=e.onLoop,D=e.volume??0,H=e.useMeter,w=e.voices??[e.samples],b=e.stacking??[];if(e.controls){e.controls.voiceList&&e.controls.voiceList.filter((e=>!w.includes(e))).forEach((e=>{e&&w.push(e)}));let t=e.controls.startLoops.flatMap((e=>e.flatMap((e=>e.voice)))).filter((e=>!w.includes(e)));t.length>0&&t.forEach((e=>{e&&w.push(e)}))}0===w.length&&w.push("FMSynth");let T,I=e.withRecording,F=e.withCount;I&&(T=new Tone.Recorder,F||(F=+prompt("Record number of mutations?",10)));let M="string"==typeof e.tonic?e.tonic:o[e.tonic];e.transform||(e.transform=e.tonic);let O="string"==typeof e.transform?e.transform:o[e.transform],x={...t,...e.controls},U=new n(x),G=[];if("string"==typeof e.parts[0]){const t=e.parts.map((e=>[e,h]));G.push(new i(t,x,h,u))}else if("number"==typeof e.parts[0]){const t=e.parts.map((e=>[o[e],h]));G.push(new i(t,x,h,u))}else if(Array.isArray(e.parts[0]))if(Array.isArray(e.parts[0][0]))for(let t=0;t<e.parts.length;t++){const n=e.parts[t],o=e.parts[t].map((e=>parseInt(e[1])));h=Math.max(...o)+"n",G.push(new i(n,x,h,u))}else{const t=e.parts;G.push(new i(t,x,h,u));const n=e.parts.map((e=>parseInt(e[1])));h=Math.max(...n)+"n"}let B,L=0,R=0,$=[],S=[],P=0,q=0;const _=e.useMetro;let j,N=[...w,...b.flatMap((e=>e))].some((e=>!e.includes("Synth"))),K=!1,Q=!1;async function V(){try{await Tone.start(),N?function(t){let n=function(){let e={};return new Set([...w,...b.flatMap((e=>e))]).forEach((t=>{if("choir"===t)"AEIOU".split("").forEach((n=>{const o=g["choir"+n];for(const a in o)e[`${t}-${n}-${a}`]=`${t}/${n}/${o[a]}`}));else for(const n in g[t])e[`${t}-${n}`]=`${t}/${g[t][n]}`})),e}();console.time(`load ${w.join(", ")}`),l=new Tone.ToneAudioBuffers({urls:n,baseUrl:e.samplesURL||"../samples/",onload:()=>{console.timeEnd(`load ${w.join(", ")}`),t&&t(),K=!0}})}(z):z()}catch(e){console.error("load tone error",e)}}function z(){a&&a(),B=new Tone.Loop(W,h),Tone.Transport.start(),e.bpm&&(Tone.Transport.bpm.value=e.bpm),B.start(Tone.Transport.seconds),H&&(r=new Tone.Meter({channels:2}),Tone.Destination.connect(r),e.setMeter(r)),(v||Q)&&J(),_&&(j=new Tone.MetalSynth({volume:-12,frequency:250,envelope:{attack:.01,decay:.01,release:.2},harmonicity:3.1,modulationIndex:32,resonance:4e3,octaves:1.5}).toDestination()),p=!0,I&&T.start()}function J(){q=0;const t=[];for(let e=0;e<$.length;e++)t.push($[e].voice);for(let e=0;e<S.length;e++)t.push(S[e]);$=[],S=[];for(let e=0;e<t.length;e++){t[e];setTimeout((()=>{t[e].dispose()}),1e3)}let n=G.filter(((e,t)=>A[t][L]));for(let e=0;e<n.length;e++){const t=n[e].getLoops();for(let e=0;e<t.length;e++){const n=t[e];let o=n.voice??m(w);b[e]&&b[e].length>0&&(o=m(b[e]));const a={...n,melody:0===n.harmony?s(n.melody,M,O):c(n.melody,M,O,n.harmony,y,k),voice:X(o,{...n,volume:D})};$.push(a)}}P=Math.max(0,Math.max(...$.map((e=>e.melody.length))));const o=Math.max(...$.flatMap((e=>e.melody.map((e=>e[1].slice(0,-1))))));B.interval=o+"n";let a=n.map((e=>e.update()))[0];e.onMutate&&e.onMutate(a),L++,L>=A[0].length&&(L=0),R++,"stopped"===Tone.Transport.state&&Tone.Transport.start(),F&&R>F*A[0].length&&(Tone.Transport.stop(),p=!1,T&&Y()),E&&E(R,a)}function W(e){_&&j.triggerAttackRelease("C4","4n",e,.1);for(let t=0;t<$.length;t++){const n=$[t],o=new d(...x.attackStep);if(o.set(n.attack),!(n.count>n.countEnd)){for(let t=0;t<n.beatCount;t++){if(n.count<n.startDelay)continue;if(n.count%1!=0&&!n.doubler)continue;if(C(n.restChance))continue;const a=n.melody[Math.floor(n.count-n.startDelay+n.startIndex)%n.melody.length];if(null!==a[0]){const[r,s]=a;let c=t*Tone.Time(2*+s.slice(0,-1)+"n").toSeconds();n.voice.triggerAttackRelease(r,s,e+c,o.get())}}n.count+=1,o.update()}}q++,q===P&&J()}function X(e,t){const n=e.includes("Synth")?function(e){return new Tone.FMSynth({volume:e.volume||-6,envelope:{attack:e.voiceAttack,attackCurve:e.voiceCurve,release:e.voiceRelease,releaseCurve:e.voiceCurve}})}(t):function(e,t){const n=function(e){const t={};if("choir"===e){const n=R<3?"U":m("AEIOU".split(""));for(const o in g[e+n])t[o]=l.get(`${e}-${n}-${o}`)}else for(const n in g[e])t[n]=l.get(`${e}-${n}`);return t}(e),o=["toms"].includes(e)?t.voiceAttack/4:t.voiceAttack;return new Tone.Sampler({urls:n,volume:t.volume||0,attack:o,release:t.voiceRelease,curve:t.voiceCurve})}(e,t);return I?n.chain(Tone.Destination,T):n.toDestination(),U.get(R,e).forEach((e=>{I?e.chain(Tone.Destination,T):e.toDestination(),n.connect(e),S.push(e)})),n}async function Y(){const t=await T.stop(),n=URL.createObjectURL(t),o=document.createElement("a"),a=prompt("Name clip",e.title||"Doodoo_"+(new Date).toDateString().replace(/ /g,"-"));o.download=a+".webm",o.href=n,o.click()}return f&&V(),{play:function(){if(!f)return V();!N||K?(J(),B.start(Tone.Transport.seconds),p=!0,I&&T.start()):Q=!0},stop:function(){Tone.Transport.stop(),B.stop(),p=!1,I&&"started"===T.state&&Y()},mutate:function(){G.forEach((e=>{e.update()}))},moveTonic:function(e){let t=o.indexOf(transpose)+e;transpose=o[t]},setTonic:function(e){transpose=e},moveBPM:function(e){let t=Tone.Transport.bpm.value;Tone.Transport.bpm.value=t+e},setBPM:function(e){Tone.Transport.bpm.value=e},getIsPlaying:function(){return p},isRecording:function(){return!!T&&("started"===T.state||"paused"===T.state)},printLoops:function(){console.log("loops",$)},getLoops:function(){return $},printParams:function(){console.log(G.map((e=>e.getParams())))}}};const o=["C_1","C#_1","D_1","D#_1","E_1","F_1","F#_1","G_1","G#_1","A_1","A#_1","B_1","C0","C#0","D0","D#0","E0","F0","F#0","G0","G#0","A0","A#0","B0","C1","C#1","D1","D#1","E1","F1","F#1","G1","G#1","A1","A#1","B1","C2","C#2","D2","D#2","E2","F2","F#2","G2","G#2","A2","A#2","B2","C3","C#3","D3","D#3","E3","F3","F#3","G3","G#3","A3","A#3","B3","C4","C#4","D4","D#4","E4","F4","F#4","G4","G#4","A4","A#4","B4","C5","C#5","D5","D#5","E5","F5","F#5","G5","G#5","A5","A#5","B5","C6","C#6","D6","D#6","E6","F6","F#6","G6","G#6","A6","A#6","B6","C7","C#7","D7","D#7","E7","F7","F#7","G7","G#7","A7","A#7","B7","C8","C#8","D8","D#8","E8","F8","F#8","G8","G#8","A8","A#8","B8","C9","C#9","D9","D#9","E9","F9","F#9","G9"],a=[12,83];function r(e){for(false;e<a[0];)e+=12;for(;e>a[1];)e-=12;return e}function s(e,t,n,a){return e.map((e=>{if(null===e[0])return e;{const[a,s]=e,c=o.indexOf(t)-o.indexOf(n),l=o.indexOf(a)-c;return[o[r(l)],s]}}))}function c(e,t,n,a,s,c=!1){return e.map((e=>{if(null===e[0])return e;{const[l,u]=e,i=o.indexOf(l),p=o.indexOf(t),m=p-o.indexOf(n),h=12*(Math.floor(i/12)-Math.floor(p)/12),y=i-p,C=y<0?s.indexOf(12-Math.abs(y)%12):s.indexOf(y%12);let g=s[(C+a-1)%s.length];c&&(g+=12*Math.floor((C+a-1)/s.length)),-1===C&&(console.log("not in scale"),g=0);let v=12*Math.floor(Math.abs(y)/12)*Math.sign(y),f=o.indexOf(t)+g+v-m+h;return[o[r(f)],u]}}))}function l(e,t,n){let o=new p(t.min??{value:0}),a=new p(t.max??{value:1}),r=new p(t.step??{value:1}),s=new p(t.kick??{value:0}),c=new p(t.chance??{value:.5}),l=new p(t.type??{value:"value"}),u=!1;function i(){e<o.get()&&(e=o.get()),e>a.get()&&(e=a.get())}return{update:function(t){if(!u){if(t<s.get())return;t>=s.get()&&(u=!0)}C(c.get())&&(o.update(t),a.update(t),"walk"===l.get()&&(e+=C(.5)?r.get():-r.get()),"walkUp"===l.get()&&(e+=r.get()),"walkDown"===l.get()&&(e-=r.get()),i())},get:function(){return"range"===l.get()&&u?m(o.get(),a.get()):(i(),e)}}}function u(e,t,n,o){let a=+n.slice(0,-1),r={};for(const e in t)r[e]=new p(t[e],e);function s(t){return e.flatMap((e=>{let[n,o]=e,r=+o.slice(0,-1),s=t/4*r,c=a/s,l=[[n,s+"n"]];for(let e=1;e<c;e++)l.push([null,a+"n"]);return l}))}return{get:function(){const e=[],t=r.loopNum.getInt();for(let o=0;o<t;o++){let t=r.beatList.get();t>n/2&&(t=4);let c=s(t),l=r.startIndex.getInt();if(l>0){for(console.log("start index",o,l),console.log("mel",c.map((e=>e[0])));null===c[l][0];)l++,l>=c.length&&(l=0),console.log("while",l,c[l][0]);c=c.slice(l).concat(c.slice(0,l)),console.log("new mel",c.map((e=>e[0])))}const u=o>0?r.startDelay.getInt():0;for(let e=0;e<u;e++)c.unshift([null,a+"n"]);e.push({melody:c,count:0,countEnd:c.length-1,beatCount:1,harmony:C(r.harmonyChance.get())?r.harmonyList.get():0,instrument:r.instruments.get(o)})}return e},update:function(e){for(const t in r)r[t].update(e)}}}function i(e,t,n,o){let a=0;const r=+n.slice(0,-1),s=new f(...t.attackStart),c=new f(...t.restChance),l=new f(...t.loopNums),u=new v(t.harmonyList,t.harmonyIndex,t.harmonyUpdateChance),i=new f(...t.startIndexes),p=new v(t.durationList,t.durationIndex,t.durationChance),y=new v(t.startDelayList,t.startDelayIndex,t.startDelayChance),g=new d(...t.harmonyChance),k=new f(...t.sliceLength),A=new v(t.voiceList,t.voiceIndex,t.voiceChance),E=new f(...t.voiceAttack),D=new f(...t.voiceRelease),H=new v(t.voiceCurve,t.voiceCurveIndex,t.voiceCurveUpdateChance),w=I(e,r),b={noteDuration:4,count:0,counter:1,repeat:1,startIndex:0,startDelay:0,harmony:0,melody:w,countEnd:w.length-1,beatCount:1,attack:.5,restChance:0,voiceAttack:.1,voiceRelease:1,voiceCurve:"linear"},T=t.startLoops.map((e=>e.map((e=>({...b,...e})))));function I(e,t,n){return e.flatMap((e=>{let[o,a]=e;a=+a.slice(0,-1);let r=t/a;n&&n<t&&(r=t/n,a=t/a*(a/n));let s=[[o,a+"n"]];for(let e=1;e<r;e++)s.push([null,t+"n"]);return s}))}return{update:function(){return function(){if(l.update(),u.update(),i.update(),p.update(),y.update(),g.update(),A.update(),H.update(),C(t.sliceChance)){let t=h(e.length),n=e.slice(t,t+k.getRandInt());e.push(...n)}C(t.shiftChance)&&e.length>t.shiftLength&&e.shift(),a++,o&&console.log(`${a} mutations`)}(),a},getLoops:function(n,o){if(T[a])return T[a];const h=[],v=Math.min(t.maxLoops,l.getRandInt()),f=new d(...t.indexStep);f.set(i.getRandInt());let k=0;for(let n=0;n<v;n++){const n=p.getRandom();let o=I(e,r,n);const a=n>9?m(t.repeat):1;h.push({noteDuration:n,count:0,beatCount:n<32&&C(t.doublerChance)?2:1,countEnd:(o.length-1)*a+k,repeat:a,startIndex:f.get(),startDelay:k,melody:o,harmony:C(g.get())?u.getRandom():0,attack:s.getRandom(),restChance:c.getRandom(),voice:A.getRandom(),voiceAttack:E.getRandom(),voiceRelease:D.getRandom(),voiceCurve:H.getRandom()}),f.update(),k=y.getRandom()}return h},getParams:function(){return{loopNums:l.getRange(),durationList:p.getSlice(),startIndexes:i.getRange(),startDelayList:y.getSlice(),harmonyList:u.getSlice(),harmonyChance:g.get(),attackStart:s.getRange(),restChance:c.getRange(),voiceList:A.getSlice(),voiceAttack:E.getRange(),voiceCurve:H.getSlice()}}}}window.DoodooMidi={MIDI_NOTES:o},window.NewDoo=function(e,t){let a=e.beat??"4n",r="string"==typeof e.tonic?e.tonic:o[e.tonic],l=e.transpose??r,i=e.useOctave??!1,p=e.scale??[0,2,4,5,7,9,11],h=e.sequence??[[!0]],y=(e.instruments,e.stacking,e.volume??0),C=e.autoLoad??!0,v=e.autoStart??!0,f=!1,d=e.useMeter??!1,k=(e.setMeter,e.useMetro??!1),A=e.withRecording??!1,E=e.withCount??!1,D=e.onLoop??!1,H=e.useDefaultProps??!0;const w=e.props?structuredClone(e.props):{};for(const e in DoodooProps.props)w.hasOwnProperty(e)||(w[e]=H?structuredClone(DoodooProps.props[e]):{});let b,T,I,F,M=[...new Set([...w.instruments.stack.flatMap((e=>e.list)).filter((e=>!e.includes("Synth")))])],O=0,x=0,U=!1,G=[],B=[],L=0,R=0,$=(new n({}),[]);for(let t=0;t<e.parts.length;t++){const n=e.parts[t],o=n.map((e=>parseInt(e[1])));a=Math.max(...o)+"n",G.push(new u(n,w,a,false))}async function S(){try{await Tone.start(),M.length>0?function(t){const n={};for(let e=0;e<M.length;e++){const t=M[e];if("choir"===t)"AEIOU".split("").forEach((e=>{const o=g["choir"+e];for(const a in o)n[`${t}-${e}-${a}`]=`${t}/${e}/${o[a]}`}));else for(const e in g[t])n[`${t}-${e}`]=`${t}/${g[t][e]}`}console.time(`load ${M.join(", ")}`),b=new Tone.ToneAudioBuffers({urls:n,baseUrl:e.samplesURL||"../samples/",onload:()=>{console.timeEnd(`load ${M.join(", ")}`),t&&t(),samplesLoaded=!0}})}(P):P()}catch(e){console.error("load tone error",e)}}function P(){t&&t(),T=new Tone.Loop(q,a),Tone.Transport.start(),e.bpm&&(Tone.Transport.bpm.value=e.bpm),T.start(Tone.Transport.seconds),d&&(I=new Tone.Meter({channels:2}),Tone.Destination.connect(I),e.setMeter(I)),(v||f)&&_(),k&&(metro=new Tone.MetalSynth({volume:-12,frequency:250,envelope:{attack:.01,decay:.01,release:.2},harmonicity:3.1,modulationIndex:32,resonance:4e3,octaves:1.5}).toDestination()),U=!0,A&&F.start()}function q(e){k&&metro.triggerAttackRelease("C4","4n",e,.1);for(let t=0;t<B.length;t++){const n=B[t];if(!(n.count>n.countEnd)){for(let t=0;t<n.beatCount;t++){if(n.count%1!=0)continue;const t=Math.floor(n.count)%n.melody.length,o=n.melody[t];if(null!==o[0]){const[t,a]=o;n.instrument.triggerAttackRelease(t,a,e,1)}}n.count+=1}}R++,R===L&&_()}function _(){R=0,function(){const e=[];for(let t=0;t<B.length;t++)e.push(B[t].instrument);for(let t=0;t<$.length;t++)e.push($[t]);for(let t=0;t<e.length;t++){e[t];setTimeout((()=>{e[t].dispose()}),1e3)}B=[],$=[]}(),B=[];let t=G.filter(((e,t)=>h[t][O]));for(let e=0;e<t.length;e++){const n=t[e].get();for(let e=0;e<n.length;e++){const t=n[e],o={...t,melody:0===t.harmony?s(t.melody,r,l):c(t.melody,r,l,t.harmony,p,i),instrument:j(t.instrument,{...t,volume:y})};B.push(o)}}L=Math.max(0,Math.max(...B.map((e=>e.melody.length))));const n=Math.max(...B.flatMap((e=>e.melody.map((e=>e[1].slice(0,-1))))));T.interval=n+"n",t.forEach((e=>{e.update(x)})),e.onMutate&&e.onMutate(x),O++,O>=h[0].length&&(O=0),x++,"stopped"===Tone.Transport.state&&Tone.Transport.start(),E&&x>E*h[0].length&&(Tone.Transport.stop(),U=!1,F&&saveRecording()),D&&D(x,0)}function j(e,t){const n=e.includes("Synth")?function(e){return new Tone.FMSynth({volume:e.volume||-6,envelope:{}})}(t):function(e,t){const n=function(e){const t={};if("choir"===e){const n=x<3?"U":m("AEIOU".split(""));for(const o in g[e+n])t[o]=b.get(`${e}-${n}-${o}`)}else for(const n in g[e])t[n]=b.get(`${e}-${n}`);return t}(e);return new Tone.Sampler({urls:n,volume:t.volume??0})}(e,t);return A?n.chain(Tone.Destination,F):n.toDestination(),n}return A&&(F=new Tone.Recorder,E||(E=+prompt("Record number of mutations?",10))),C&&S(),{play:function(){if(!C)return S();!usesSamples||samplesLoaded?(_(),T.start(Tone.Transport.seconds),U=!0,A&&F.start()):f=!0},stop:function(){Tone.Transport.stop(),T.stop(),U=!1,A&&"started"===F.state&&saveRecording()},getLoops:()=>B}};function p(e={},t){let n=e.hasOwnProperty("list")?"list":"value";e.hasOwnProperty("stack")&&(n="stack");let o,a=e.value??0,r=e.index??0,s=e.list??[],c=e.stack??[],u=!1;function i(e){if("stack"===n){let t;return t=e<c.length?m(c[e].list):m(c.flatMap((e=>e.list))),t}if("list"===n){let e=u?Math.round(o.get()):r;return s[Math.min(s.length-1,e)]}return u?o.get():a}return e.mod&&(u=!0,o=new l("value"===n?a:r,e.mod,t)),{update:function(e){u&&o.update(e)},get:i,getInt:function(){return Math.floor(i())}}}function m(e,t){return t?Math.random()*(t-e)+e:"number"==typeof e?Math.random()*e:Array.isArray(e)?e[Math.floor(Math.random()*e.length)]:"object"==typeof e?e[m(Object.keys(e))]:void 0}function h(e,t){return t||(t=e,e=0),Math.round(Math.random()*(t-e)+e)}function y(e){let t,n,o=e.length;for(;0!==o;)n=Math.floor(Math.random()*o),o-=1,t=e[o],e[o]=e[n],e[n]=t;return e}function C(e){return m(1)<e}window.DoodooProps={props:{instruments:{stack:[{list:["choir"]}],options:["fmSynth","choir","toms","flute","strings","guitar","piano","bamboo"]},loopNum:{value:1,step:1,mod:{type:{value:"range"},min:{value:1,chance:1,mod:{min:{value:1},max:{value:3},type:{value:"walkUp"},chance:{value:.5}}},max:{value:1,mod:{min:{value:1},max:{value:5},type:{value:"walkUp"},chance:{value:.5}}}}},harmonyChance:{value:0,step:.01,mod:{min:{value:.5},max:{value:.5},kick:{value:1},chance:{value:1}}},harmonyList:{list:[4,5,3,7,2,6],index:0,mod:{type:{value:"range"},min:{value:0},max:{value:0,mod:{min:{value:0},max:{value:5},step:{value:1},type:{value:"walkUp"}}}}},beatList:{list:[4,2,1,8,16,32],index:0,mod:{type:{value:"range"},chance:{value:1},min:{value:0},max:{value:0,mod:{max:{value:6},chance:{value:.3},type:{value:"walkUp"}}}}},startIndex:{value:0,mod:{max:{value:0,mod:{min:{value:0},max:{value:8},chance:{value:.3},type:{value:"walkUp"}}},type:{value:"range"},chance:{value:1}}},startDelay:{list:[0,1,2,4,8,3,5,7],index:6,mod:{min:{value:0},type:{value:"range"},chance:{value:1},max:{value:6,mod:{max:{value:12},chance:{value:.3},type:{value:"walkUp"}}}}}}};let g={bamboo:{B3:"b3.ogg",G4:"g4.ogg"},piano:{A4:"A4.mp3",C4:"C4.mp3"},flute:{C5:"C5.wav"},guitar:{C4:"C4.wav"},strings:{"A#2":"Ash2.ogg",A5:"A5.ogg",C4:"C4.ogg",C7:"C7.ogg","D#2":"Dsh2.ogg",D5:"D5.ogg",E3:"E3.ogg",E6:"E6.ogg",G4:"G4.ogg"},toms:{"A#3":"Tom606_EQ_FADE.ogg"},choirA:{A2:"CH-AA-A2.mp3",A3:"CH-AA-A3.mp3",A4:"CH-AA-A4.mp3",B2:"CH-AA-B2.mp3",B3:"CH-AA-B3.mp3",B4:"CH-AA-B4.mp3",C2:"CH-AA-C2.mp3",C3:"CH-AA-C3.mp3",C4:"CH-AA-C4.mp3",C5:"CH-AA-C5.mp3",D2:"CH-AA-D2.mp3",D3:"CH-AA-D3.mp3",D4:"CH-AA-D4.mp3",E2:"CH-AA-E2.mp3",E3:"CH-AA-E3.mp3",E4:"CH-AA-E4.mp3",F2:"CH-AA-F2.mp3",F3:"CH-AA-F3.mp3",F4:"CH-AA-F4.mp3",G2:"CH-AA-G2.mp3",G3:"CH-AA-G3.mp3",G4:"CH-AA-G4.mp3"},choirE:{A2:"CH-EE-A2.mp3",A3:"CH-EE-A3.mp3",A4:"CH-EE-A4.mp3",B2:"CH-EE-B2.mp3",B3:"CH-EE-B3.mp3",B4:"CH-EE-B4.mp3",C2:"CH-EE-C2.mp3",C3:"CH-EE-C3.mp3",C4:"CH-EE-C4.mp3",C5:"CH-EE-C5.mp3",D2:"CH-EE-D2.mp3",D3:"CH-EE-D3.mp3",D4:"CH-EE-D4.mp3",E2:"CH-EE-E2.mp3",E3:"CH-EE-E3.mp3",E4:"CH-EE-E4.mp3",F2:"CH-EE-F2.mp3",F3:"CH-EE-F3.mp3",F4:"CH-EE-F4.mp3",G2:"CH-EE-G2.mp3",G3:"CH-EE-G3.mp3",G4:"CH-EE-G4.mp3"},choirI:{A2:"CH-II-A2.mp3",A3:"CH-II-A3.mp3",A4:"CH-II-A4.mp3",B2:"CH-II-B2.mp3",B3:"CH-II-B3.mp3",B4:"CH-II-B4.mp3",C2:"CH-II-C2.mp3",C3:"CH-II-C3.mp3",C4:"CH-II-C4.mp3",C5:"CH-II-C5.mp3",D2:"CH-II-D2.mp3",D3:"CH-II-D3.mp3",D4:"CH-II-D4.mp3",E2:"CH-II-E2.mp3",E3:"CH-II-E3.mp3",E4:"CH-II-E4.mp3",F2:"CH-II-F2.mp3",F3:"CH-II-F3.mp3",F4:"CH-II-F4.mp3",G2:"CH-II-G2.mp3",G3:"CH-II-G3.mp3",G4:"CH-II-G4.mp3"},choirO:{A2:"CH-OO-A2.mp3",A3:"CH-OO-A3.mp3",A4:"CH-OO-A4.mp3",B2:"CH-OO-B2.mp3",B3:"CH-OO-B3.mp3",B4:"CH-OO-B4.mp3",C2:"CH-OO-C2.mp3",C3:"CH-OO-C3.mp3",C4:"CH-OO-C4.mp3",C5:"CH-OO-C5.mp3",D2:"CH-OO-D2.mp3",D3:"CH-OO-D3.mp3",D4:"CH-OO-D4.mp3",E2:"CH-OO-E2.mp3",E3:"CH-OO-E3.mp3",E4:"CH-OO-E4.mp3",F2:"CH-OO-F2.mp3",F3:"CH-OO-F3.mp3",F4:"CH-OO-F4.mp3",G2:"CH-OO-G2.mp3",G3:"CH-OO-G3.mp3",G4:"CH-OO-G4.mp3"},choirU:{A2:"CH-UU-A2.mp3",A3:"CH-UU-A3.mp3",A4:"CH-UU-A4.mp3",B2:"CH-UU-B2.mp3",B3:"CH-UU-B3.mp3",B4:"CH-UU-B4.mp3",C2:"CH-UU-C2.mp3",C3:"CH-UU-C3.mp3",C4:"CH-UU-C4.mp3",C5:"CH-UU-C5.mp3",D2:"CH-UU-D2.mp3",D3:"CH-UU-D3.mp3",D4:"CH-UU-D4.mp3",E2:"CH-UU-E2.mp3",E3:"CH-UU-E3.mp3",E4:"CH-UU-E4.mp3",F2:"CH-UU-F2.mp3",F3:"CH-UU-F3.mp3",F4:"CH-UU-F4.mp3",G2:"CH-UU-G2.mp3",G3:"CH-UU-G3.mp3",G4:"CH-UU-G4.mp3"}};function v(e,t,n){return void 0===n&&(n=.5),{update:()=>{t!==e.length&&C(n)&&t++},getRandom:()=>m(e.slice(0,t)),getSlice:()=>e.slice(0,t),get:()=>e}}function f(e,t,n,o){return{update:function(){C(Math.abs(n))&&e+Math.sign(n)<t&&(e+=Math.sign(n)),C(Math.abs(o))&&t+Math.sign(o)>e&&(t+=Math.sign(o))},getRange:()=>[e,t],getRandom:()=>m(e,t),getRandInt:()=>h(e,t),getMin:()=>e,getMax:()=>t}}function d(e,t=.1,n=1,o=0,a=1,r=0,s=!1){function c(t){(e=t)<o&&(e=o),e>a&&(e=a)}return a<e&&(a=e),{update:function(){C(n)&&c(e+(C(.5+r/2)?t:-t))},set:c,get:()=>e,setMin:e=>{o=e},setMax:e=>{a=e}}}}();
//# sourceMappingURL=src_maps/doodoo.min.js.map
