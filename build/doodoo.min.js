(()=>{var t={822:t=>{let e=[{key:"attackStart",value:[.25,.7],type:"range",range:[0,1],step:.05},{key:"attackStep",value:[-.2,.2],type:"range",range:[-1,1],step:.05}],o={};e.forEach((t=>{const{key:e,value:n}=t;o[e]=n})),t.exports={doodooParams:e,doodooDefaults:o}}},e={};function o(n){var r=e[n];if(void 0!==r)return r.exports;var a=e[n]={exports:{}};return t[n](a,a.exports,o),a.exports}o.d=(t,e)=>{for(var n in e)o.o(e,n)&&!o.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},o.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e);var n={};(()=>{"use strict";function t(e,o){return o?Math.random()*(o-e)+e:"number"==typeof e?Math.random()*e:Array.isArray(e)?e[Math.floor(Math.random()*e.length)]:"object"==typeof e?e[t(Object.keys(e))]:void 0}function e(e){return t(1)<e}o.d(n,{default:()=>p});class r{constructor(t,e){this.min=t,this.max=void 0===e?t:e}update(t,o){e(Math.abs(t))&&this.min<this.max&&(this.min+=Math.sign(t)),e(Math.abs(o))&&(this.max+=Math.sign(o))}get range(){return[this.min,this.max]}get random(){return t(...this.range)}get randInt(){return function(t,e){return e||(e=t,t=0),Math.round(Math.random()*(e-t)+t)}(...this.range)}}class a{constructor(t,e){this.values=t,this.addValues=e||[]}add(t){this.values.push(t)}update(t){e(t)&&this.addValues.length>0&&this.values.push(this.addValues.pop())}get random(){return t(this.values)}}const s=["C_1","C#_1","D_1","D#_1","E_1","F_1","F#_1","G_1","G#_1","A_1","A#_1","B_1","C0","C#0","D0","D#0","E0","F0","F#0","G0","G#0","A0","A#0","B0","C1","C#1","D1","D#1","E1","F1","F#1","G1","G#1","A1","A#1","B1","C2","C#2","D2","D#2","E2","F2","F#2","G2","G#2","A2","A#2","B2","C3","C#3","D3","D#3","E3","F3","F#3","G3","G#3","A3","A#3","B3","C4","C#4","D4","D#4","E4","F4","F#4","G4","G#4","A4","A#4","B4","C5","C#5","D5","D#5","E5","F5","F#5","G5","G#5","A5","A#5","B5","C6","C#6","D6","D#6","E6","F6","F#6","G6","G#6","A6","A#6","B6","C7","C#7","D7","D#7","E7","F7","F#7","G7","G#7","A7","A#7","B7","C8","C#8","D8","D#8","E8","F8","F#8","G8","G#8","A8","A#8","B8","C9","C#9","D9","D#9","E9","F9","F#9","G9"],u=[12,83];function l(t){for(;t<u[0];)t+=12;for(;t>u[1];)t-=12;return t}function i(t,e,o,n){return t.map((r=>{const[a,u]=r;if(null===a)return r;{const r=s.indexOf(a)-s.indexOf(t[0][0]);let i=12*Math.floor(Math.abs(r)/12)*(r<0?-1:1),c=r<0?n.indexOf(12-Math.abs(r)%12):n.indexOf(r%12),d=n[(c+o-1)%n.length],p=s.indexOf(e)+d+i;return[s[l(p)],u]}}))}function c(o,n){let s=0;const u=new r(1),l=new a([4,5],function(t){let e,o,n=t.length;for(;0!==n;)o=Math.floor(Math.random()*n),n-=1,e=t[n],t[n]=t[o],t[o]=e;return t}([2,3,6,7])),i=new r(0),c=new r(0),d=new a([2,4],[1,8,16,32]),p=new a([0,1,2,4,.5,8],[12,16,3,5,7,11]),h=[[{noteDuration:8,count:0,counter:1,doubler:!1,doublerCounter:!1,repeat:1,startIndex:0,startDelay:0,melody:o,harmony:0}],[{noteDuration:4,count:0,counter:1,doubler:!1,doublerCounter:!1,repeat:1,startIndex:0,startDelay:0,melody:o,harmony:0},{noteDuration:4,count:0,counter:1,doubler:!1,doublerCounter:!1,repeat:1,startIndex:0,startDelay:0,melody:o,harmony:4}]];this.getTestLoops=function(){return[{noteDuration:4,count:0,counter:1,doubler:!1,doublerCounter:!1,repeat:1,startIndex:0,startDelay:0,melody:o,harmony:0},{noteDuration:4,count:0,counter:1,doubler:!1,doublerCounter:!1,repeat:1,startIndex:0,startDelay:0,melody:o,harmony:4}]},this.getLoops=function(){if(h[s])return h[s];const n=[],r=1==s?2:u.randInt;let a=i.randInt,m=0;for(let s=0;s<r;s++){let r=d.random;n.push({noteDuration:r,count:0,counter:r<4?r/4:1,doubler:r>4&&r<32&&e(.5),doublerCounter:r>4&&e(.4),repeat:r>9?t([2,3,4]):1,startIndex:a,startDelay:m,melody:o,harmony:e(.6)?l.random:0}),a=Math.max(0,t([a,a+c.min,a+c.max])),m=p.random}return n},this.update=function(){return function(){if(u.update(.1,.2),l.update(.2),i.update(0,.3),c.update(-.2,.2),d.update(.3),p.update(.3),e(.1)){let e=t(o.length),n=o.slice(e,e+t(3));o.push(...n)}e(.2)&&o.length>16&&o.shift(),s++,n&&console.log(`${s} mutations`)}(),s}}var d=o(822);Number.prototype.clamp=function(t,e){return Math.min(Math.max(this,t),e)};const p={Doodoo:function(o,n){let a,u,p,h=!1,m=[],f=o.debug,y=o.samples||"synth",D=o.startDuration||"4n",g=o.withRecording;g&&(u=new Tone.Recorder,p=+prompt("Record number of mutations?",10));const b=o.scale||[0,2,4,5,7,9,11];let T="string"==typeof o.tonic?o.tonic:s[o.tonic],C=[];if("string"===o.parts[0]){const t=o.parts.map((t=>[t,D]));C.push(new c(t,f))}else if("number"==typeof o.parts[0]){const t=o.parts.map((t=>[s[t],D]));C.push(new c(t,f))}else if(Array.isArray(o.parts[0])){const t=o.parts;C.push(new c(t,f));const e=o.parts.map((t=>parseInt(t[1])));D=Math.max(...e)+"n"}let w=0,x=0,A=o.params,v={...d.doodooDefaults,...A};console.log(v);const M=new r(...v.attackStart),F=new r(...v.attackStep);let E,G=[];const I=o.useMetro;let O;async function B(){await Tone.start(),"synth"!==y?function(t){m=[2,3,4].flatMap((t=>"ABCDEFG".split("").map((e=>`${e}${t}`))));let e={};for(let t=0;t<m.length;t++)"AEIOU".split("").forEach((o=>{const n=m[t];e[`${o}-${n}`]=`${o}/CH-${o}${o}-${n}.mp3`}));console.time("load choir samples"),a=new Tone.ToneAudioBuffers({urls:e,baseUrl:o.samples||"./doodoo/samples/choir/",onload:()=>{console.timeEnd("load choir samples"),t()}})}(_):_()}function _(){n&&n(),E=new Tone.Loop($,D),Tone.Transport.start(),o.bpm&&(Tone.Transport.bpm.value=o.bpm),E.start(0),k(),I&&(O=new Tone.MetalSynth({volume:-12,frequency:250,envelope:{attack:.01,decay:.01,release:.2},harmonicity:3.1,modulationIndex:32,resonance:4e3,octaves:1.5}).toDestination()),h=!0,g&&u.start()}function k(){G=[],C[w].getLoops().forEach((t=>{const e={...t,melody:0===t.harmony?(o=t.melody,n=T,o.map((t=>{const[e,r]=t;if(null===e)return t;{let t=s.indexOf(n)+(s.indexOf(e)-s.indexOf(o[0][0]));return[s[l(t)],r]}}))):i(t.melody,T,t.harmony,b),sampler:"synth"!==y?S():L(),attack:M.random,ended:!1};var o,n;G.push(e)})),G.forEach((t=>{let e=[];t.melody.forEach((t=>{const[o,n]=t;let r=+D[0]/+n[0];e.push(t);for(let t=1;t<r;t++)e.push([null,D])})),t.melody=e}));let t=C[w].update();o.onMutate&&o.onMutate(t),w++,w>=C.length&&(w=0),x++,"stopped"===Tone.Transport.state&&Tone.Transport.start(),t>p&&(Tone.Transport.stop(),h=!1,P())}function $(t){I&&O.triggerAttackRelease("c4","4n",t,.3);let e=M.random;for(let o=0;o<G.length;o++){const n=G[o],{melody:r,noteDuration:a,sampler:s,counter:u,doubler:l,doublerCounter:i,repeat:c,startIndex:d,startDelay:p}=G[o];if(n.count>(r.length-1)*c+p&&(n.ended=!0),!n.ended){let c=l?u*a/4:1;for(let h=0;h<c;h++)if(n.count>=p&&(n.count%1==0||l)){const l=r[Math.floor(n.count-p+d)%r.length];if(!l){console.log("beat",l,d),console.log("loop",o,n);continue}if(null!==l[0]){const[o,n]=l;let r=h?Tone.Time(`${a}n`).toSeconds()*h:0;s.triggerAttackRelease(o,n,t+r,e)}i&&(n.count+=u)}(!i||n.count<p)&&(n.count+=u)}}G.every((t=>t.ended))?k():(e+=F.random,console.log(e,typeof e),e.clamp(.1,1))}function L(){const t=(new Tone.FMSynth).toDestination();return g&&t.connect(u),t}function S(){const o=x<3?"U":t("AEIOU".split("")),n={};for(let t=0;t<m.length;t++){const e=m[t];n[e]=a.get(`${o}-${e}`)}const r=new Tone.Sampler({urls:n,volume:-6,release:1}).toDestination(),s=new Tone.Reverb({decay:5}).toDestination();if(r.connect(s),x>8){let o;if(e(.25)){const e=t(.05,.2);o=new Tone.Distortion(e).toDestination()}else if(e(.25))o=new Tone.Chorus(6,2.5,.5);else if(e(.25)){const e=t([4,8,12]);o=new Tone.BitCrusher(e).toDestination()}else if(e(.25)){const e=t(.5,1),n=t(.1,1);o=new Tone.Tremolo(e,n).toDestination()}o&&r.connect(o)}return g&&r.connect(u),r}async function P(){const t=await u.stop(),e=URL.createObjectURL(t),o=document.createElement("a"),n=prompt("Name clip","Doodoo_"+(new Date).toDateString().replace(/ /g,"-"));o.download=n+".webm",o.href=e,o.click()}o.autoLoad&&B(),this.moveTonic=function(t){let e=s.indexOf(T)+t;T=s[e],T=s[e]},this.setTonic=function(t){T=t},this.printLoops=function(){console.log("loops",G)},this.moveBPM=function(t){let e=Tone.Transport.bpm.value;Tone.Transport.bpm.value=e+t},this.setBPM=function(t){Tone.Transport.bpm.value=t},this.getIsPlaying=function(){return h},this.play=function(){if(!o.autoLoad)return B();"stopped"===Tone.Transport.state&&k(),h=!0,g&&u.start()},this.stop=function(){Tone.Transport.stop(),h=!1,g&&P()},this.mutate=function(){C.forEach((t=>{t.update()}))}},MIDI_NOTES:s,doodooDefaults:d.doodooDefaults,doodooParams:d.doodooParams}})(),window.doodooLib=n.default})();
//# sourceMappingURL=doodoo.min.js.map