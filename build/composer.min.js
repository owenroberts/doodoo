!function(){"use strict";const{MIDI_NOTES:e}=DoodooMidi,{defaults:t,controls:l}=DoodooControls,{Interface:n,Settings:a}=UI,{UIElement:o,UICollection:c,UIButton:i,UILabel:s,UINumberStep:r,UIListStep:u,UIChance:d,UINumberList:p,UISelectButton:f,UIText:b,UIRow:g,UIToggleCheck:h,UIFile:k,UIInput:m,UIInputList:y,UITree:x,UIToggleGrid:v}=UI.Elements,w={},I={title:"Doodoo_"+(new Date).toDateString().replace(/ /g,"-"),tonic:"C4",scale:[0,2,4,5,7,9,11],duration:"4n",bpm:120,voices:["choir"]};w.controls=new function(e,t,l){let n,a,o,c={},u=JSON.parse(JSON.stringify(t));const k={noteDuration:4,count:0,beatCount:1,repeat:1,startIndex:0,startDelay:0,harmony:0,voice:"choir"};function m(e){let t=e[0].toUpperCase()+e.substring(1);return t=t.replace(/(?<=[a-z])(?=[A-Z])/g," "),t}function v(e,l){const{key:n,type:a}=e;l.add(new i({text:"Reset",callback:()=>{w(n,l)}})),l.addBreak(),"range"===a&&function(e,t,l){let{key:n,value:a,range:o,step:c}=e;l&&t.add(new s({text:l}));if(C({...e,index:0},t,"Min"),C({...e,index:1},t,"Max"),a.length>2){let l=o.length<=2?[0,1]:o.slice(2);I({...e,range:l,index:2},t,"Min"),I({...e,range:l,index:3},t,"Max")}}(e,l),"list"===a&&e.value&&function(e,l,n){let{key:a,value:o}=e;n&&l.add(new s({text:n}));"number"==typeof o[0]?l.add(new p({list:o,callback:e=>{t[a]=e}})):l.add(new y({list:o,callback:e=>{t[a]=e}}))}(e,l),"chance"===a&&I(e,l),"number"===a&&C(e,l),"walker"===a&&function(e,t,l){let{key:n,value:a}=e;l&&t.add(new s({text:l}));C({...e,index:0},t),t.add(new s({text:"Walker",class:"break"})),C({...e,index:1},t,"Step"),I({...e,index:2},t),C({...e,index:3},t,"Min"),C({...e,index:4},t,"Max"),C({...e,index:5,range:[-1,1],step:.1},t,"Dir")}(e,l),l.addBreak()}function w(e,n,a){const o=l.filter((t=>t.key===e))[0];o&&(void 0===a&&(a=Array.isArray(u[e])?[...u[e]]:u[e]),t[e]=a,o.value=a,n||(n=c[e]),n.clear(),v(o,n))}function I(e,l,n){let{key:a,value:o,index:c,range:i}=e;n&&l.add(new s({text:n})),l.add(new d({label:"Chance",value:void 0!==c?o[c]:o,min:i?i[0]:0,max:i?i[1]:1,step:.01,callback:e=>{void 0!==c?t[a][c]=e:t[a]=e}}))}function C(e,l,n){let{key:a,value:o,range:c,step:i,index:u}=e;n&&l.add(new s({text:n})),l.add(new r({value:void 0!==u?o[u]:o,min:c?c[0]:0,max:c?c[1]:100,step:e.step||1,callback:e=>{void 0!==u?t[a][u]=e:t[a]=e}}))}function P(e,l){const n=e.value,a=new s({text:"Counts"});l.add(a);const o=new i({text:"â€“",class:"left-end",callback:()=>{t.startLoops.pop(),l.removeK("count"+t.startLoops.length)}});l.add(o);const c=new i({text:"+",class:"right-end",callback:()=>{const e=[{}];t.startLoops.push(e),S(t.startLoops.length-1,e,l)}});l.add(c);for(let e=0;e<n.length;e++)S(e,n[e],l)}function S(e,l,n){const a=new g({class:"break-line-up"});n.add(a,"count"+e);const o=new s({text:"Count "+e});a.add(o);const c=new s({text:"Loops"});a.add(c);const r=new i({text:"â€“",class:"left-end",callback:()=>{t.startLoops[e].pop(),a.removeK("loop"+t.startLoops[e].length)}});a.add(r);const u=new i({text:"+",class:"right-end",callback:()=>{t.startLoops[e].push({}),U(e,t.startLoops[e].length-1,{},a)}});a.add(u);for(let t=0;t<l.length;t++)U(e,t,l[t],a)}function U(e,t,l,n){const a=new g;n.append(a,"loop"+t);const o=new s({text:"Loop "+t});a.append(o);const c=new f({options:Object.keys(k),callback:l=>{L(l,k[l],e,t,a)}});a.append(c);for(const n in l)L(n,l[n],e,t,a)}function L(e,l,n,a,o){let c=m(e);switch(typeof l){case"boolean":let i=new h({value:l,callback:l=>{t.startLoops[n][a][e]=l}});o.append(new s({text:c})),o.append(i),t.startLoops[n][a][e]=l;break;case"number":let u=new r({value:l,callback:l=>{t.startLoops[n][a][e]=l}});o.append(new s({text:c})),o.append(u),t.startLoops[n][a][e]=l;break;case"string":let d=new b({value:l,callback:l=>{t.startLoops[n][a][e]=l}});o.append(new s({text:c})),o.append(d),t.startLoops[n][a][e]=l}o.append(new s({class:"break"}))}function M(){let e=l.findIndex((e=>"fxLimit"===e.key));for(let t=0;t<e;t++){const{key:e,panel:n}=l[t];"loops"!==e&&w(e)}}function T(){for(let e=l.findIndex((e=>"fxLimit"===e.key));e<l.length;e++){const{key:t,panel:n}=l[e];w(t)}}function E(){for(let e=l.findIndex((e=>"fxLimit"===e.key));e<l.length;e++){const{key:t,panel:n}=l[e];t.includes("Chance")&&w(t,void 0,0)}}return{get:function(){return{...t}},load:function(e){if(e)for(const l in e){e[l];"startLoops"===l?(n.clear(),t.startLoops=e[l],P({value:e[l]},n)):w(l,void 0,e[l])}else{let e=!1;for(let t=0;t<l.length;t++){const i=l[t],{key:s,type:r}=i;if("loops"===r)P(i,n);else{"fxLimit"===s&&(e=!0);const t=new x({title:m(s)});c[s]=t,e?o.append(t):a.append(t),v(i,t)}}}},connect:function(){a=e.ui.getPanel("controls"),o=e.ui.getPanel("Effects");const t=e.ui.getPanel("loops",{label:"Start Loops"});e.ui.addCallbacks([{callback:M,text:"Reset Controls"}],a),e.ui.addCallbacks([{callback:T,text:"Reset Effects"},{callback:E,text:"Zero Effects"}],o),n=t.addRow("start-loops-row")}}}(w,t,l),w.composition=new function(t,l){let n,a,o,r=l.title,u=l.tonic,d=l.duration,b=l.bpm,g=l.transform||l.tonic,h=l.scale,k=l.useOctave||!1,m=[];function y(e){if(!e)return;if(Array.isArray(m)||(m=[m]),m.includes(e))return;m.push(e);const t=new c({class:"voice-collection"});t.append(new s({text:e})),t.append(new i({text:"X",callback:()=>{m.splice(m.indexOf(e),1),o.remove(t)}})),o.append(t,e)}return{connect:function(){const l=t.ui.getPanel("composition");t.ui.addUIs({title:{id:"title",value:r,callback:e=>{r=e}},tonic:{type:"UIListStep",value:u,label:"Tonic",class:"note-edit",list:[...e,"null","rest"],callback:e=>{u=e}},transform:{type:"UIListStep",value:g,label:"Tonic Transform",class:"note-edit",list:[...e,"null","rest"],callback:e=>{g=e}},bpm:{value:b,label:"BPM",type:"UINumberStep",range:[60,250],callback:e=>{b=e}},duration:{value:d,type:"UISelect",label:"Default Duration",selected:"4n",options:[{value:"1n",text:"Whole 1n"},{value:"2n",text:"Half 2n"},{value:"4n",text:"Quarter 4n"},{value:"8n",text:"Eighth 8n"}],callback:e=>{d=e}},useOctave:{type:"UIToggleCheck",label:"Use Octave",value:k,callback:e=>{k=e}}},l),l.addRow(void 0,"break"),l.add(new s({text:"Scale Intervals"})),n=l.addRow(void 0,"break"),a=new p({list:h,callback:e=>{h=e}}),l.add(a);const c=new f({label:"Voices",callback:y,selected:"synth",options:[{value:"choir",text:"Choir"},{value:"fmSynth",text:"FMSynth"},{value:"toms",text:"Toms"},{value:"bamboo",text:"Bamboo"},{value:"strings",text:"Strings"},{value:"flute",text:"Flute"},{value:"guitar",text:"Guitar"},{value:"piano",text:"Piano"}]});l.add(new s({class:"break"})),l.add(c),o=l.addRow()},load:function(n){if(n.title&&t.ui.faces.title.update(n.title),n.transform&&t.ui.faces.transform.update(n.transform),n.bpm&&t.ui.faces.bpm.update(n.bpm),n.duration&&t.ui.faces.duration.update(n.duration),n.useOctave&&t.ui.faces.useOctave.update(n.useOctave),n.voices){m=[],o.clear(),(Array.isArray(n.voices)?[...n.voices]:[n.voices]).forEach((e=>{y(e)}))}else l.voices.forEach((e=>{y(e)}));var c;n.tonic&&t.ui.faces.tonic.update("string"==typeof n.tonic?n.tonic:(c=n.tonic,e[c])),n.scale&&(h=n.scale.map((e=>+e)),a.set(h))},get:function(){t.melody.update();const e=t.melody.getParts(),l=t.melody.getSequence();return{tonic:u,transform:g,bpm:b,voices:m,title:r,duration:d,scale:h,useOctave:k,sequence:l,parts:e}}}}(w,I),w.playback=new function(e){let t,l,n=!1;function a(a,o){const c=e.composition.get();if(0===c.parts.length)return alert("Add notes to the melody.");t&&(t.stop(),Tone.Transport.cancel()),t=new Doodoo({...c,withRecording:a,withCount:o,onMutate:n=>{l.text="Mutation: "+n,e.score.update(t.getLoops())},useMetro:n,controls:e.controls.get()}),e.fio.saveLocal(c),e.score.update(t.getLoops())}return{connect:function(){const o=e.ui.getPanel("playback",{label:"Play Back"});e.ui.addCallbacks([{callback:a,key:"space",text:"Play",args:[!1]},{key:".",text:"Play Once",callback:()=>{a(!1,1)}},{key:",",text:"Stop",callback:()=>{t&&t.stop()}},{callback:a,key:"r",text:"Record",args:[!0]},{key:"d",text:"Mutate",callback:()=>{t&&t.mutate()}}],o),l=new s({id:"mutation-count",text:"Mutation 0"}),o.add(l),e.ui.addProps({useMetro:{type:"UIToggleCheck",value:n,label:"Metro",key:"m",callback:e=>{n=e}}},o),e.ui.addCallback({row:!0,callback(){t&&t.printLoops()},text:"Print Loops",key:"p"}),e.ui.addCallback({callback(){t&&t.printParams()},text:"Print Params",key:"shift-p"})},isRecording:function(){return!!t&&t.isRecording()}}}(w),w.melody=new function(t,l){let n=0,a=[],o=60,s=[],r=[[!0]],d=l.duration??"4n";const p=["32n","16n","8n","4n","2n","1n"];let f,b;function g(l,o,s,r){let d=l||t.ui.faces.noteInput.value.toUpperCase(),f=o||t.ui.faces.durationInput.value,b=new c({class:"note-collection"});b.addClass("d"+f.replace(/\./g,"dot"));let h=new u({value:d,class:"note-edit",list:[...e,"null","rest"]}),k=new u({value:f,class:"duration-edit",callback:e=>{e.includes("n")||(["1","2","4","8","16","32"].includes(e)?e+="n":e=f,k.value=e),b.el.className="note-collection d"+e.replace(/\./g,"dot"),x(),v()},list:[...p]}),m=new i({text:"+",class:"double-btn",callback:()=>{g(h.value,k.value,!1,b)}}),y=new i({text:"x",class:"remove-btn",callback:()=>{a[n].remove(b),x(),v()}});r?a[n].insert(b,r):a[n].append(b),b.append(h,"note"),b.append(k,"duration"),b.append(m),b.append(y),s||x(),s||v()}function h(e){e.forEach((e=>{if(null===e)return g("rest",d,!0);const t="string"==typeof e?e:e[0],l="string"==typeof e?d:e[1];g(null===t?"rest":t,l,!0)}))}function k(){let e=f.addRow("part-"+a.length,"break-line-up");e.addClass("part"),a.push(e),n=a.length-1,t.ui.faces.currentPart.addOption(n,"Part "+n),t.ui.faces.currentPart.value=n,r.push(Array(r[0].length).fill(!0)),b.update(r)}function m(){const e=a.pop();n>a.length-1&&(n-=1),f.removeRow(e),t.ui.faces.currentPart.removeOption(a.length),t.ui.faces.currentPart.value=n,r.pop(),b.update(r),x()}function y(){a[n].children.forEach((e=>{g(e.note.value,e.duration.value,!0)})),x(),v()}function x(){function e(e){let t=!1;const l=Array.from(e).map((e=>{let l,n=e.note.value,a=e.duration.value;return["null","rest"].includes(n)?l=null:(l=function(e){if(1===e.length||e.length>3)return!1;let t=e[0].toUpperCase(),l=e[e.length-1],n=e.includes("#")?"#":"";return!(isNaN(+l)||!"ABCDEFG".includes(t))&&t+n+l}(n),l||(t=!0)),a.length>3&&(t=!0),isNaN(+a[0])&&(t=!0),1===a.length&&(a+="n"),[l,a]}));return t?alert("use notes in MIDI format like C4 or C#4, durations like 1n, 2n, 4n, 8n, etc."):l}s=[];for(let t=0;t<a.length;t++)s.push(e(a[t].children));return s}function v(){s.length;const e=t.ui.panels.melody.el.getBoundingClientRect().width,l=s.flatMap((e=>e.map((e=>e[1]))));let n=Math.max(...l.map((e=>parseInt(e))));l.includes(n+"n."),n<0&&(n="4n");let a=4;for(;e/(a+4)>o;)a+=4;t.ui.panels.melody.setProp("--column-width",Math.floor((e-3*a)/a)),t.ui.panels.melody.setProp("--notes-per-row",a),t.ui.panels.melody.setProp("--default-duration",n)}function w(){a.forEach((e=>e.clear()))}return{connect:function(){f=t.ui.getPanel("melody"),f.addRow(void 0,"break"),t.ui.addProps({melodyScale:{type:"UINumberStep",value:12,label:"Scale",callback:e=>{f.setProp("--ui-scale",e),v()},reset:!0},noteWidth:{type:"UINumberStep",label:"Note Width",value:80,callback:e=>{o=e,a[0]&&v()},range:[40,200],reset:!0}},f),f.addRow(void 0,"break"),t.ui.addProp("currentPart",{type:"UISelect",options:[{value:0,text:"Part 0"}],callback:e=>{n=+e}},f),t.ui.addCallbacks([{callback:k,text:"+"},{callback:m,text:"â€“"},{callback:w,text:"Clear",key:"0"}],f),t.ui.addProps({noteInput:{type:"UIListStep",value:"C4",class:"note-edit",list:[...e,"null","rest"]},durationInput:{type:"UIListStep",value:"4n",list:[...p],callback:e=>{e.includes("n")&&(d=e)}}},f),t.ui.addUI({type:"UIButton",callback:g,text:"+",key:"+"},f),t.ui.addUI({type:"UIButton",callback:y,text:"Double It"},f),f.addRow(void 0,"break"),b=t.ui.addUI({type:"UIToggleGrid",text:"Part Sequencer",value:r,callback:e=>{r=e}},f),f.addRow("melody","break"),a[0]=f.addRow("part-0","break-line-up"),a[0].addClass("part")},clear:w,update:x,load:function(e){if(e.sequence&&(r=e.sequence,b.update(e.sequence)),e.parts){if(w(),s=[],Array.isArray(e.parts[0]))if(Array.isArray(e.parts[0][0]))for(let l=0;l<e.parts.length;l++)n=l,l>0&&(a[l]=f.addRow("part-"+l,"break-line-up"),a[l].addClass("part"),t.ui.faces.currentPart.addOption(l,"Part "+l)),h(e.parts[l]);else h(e.parts);else h(e.parts);if(x(),n=0,e.sequence){if(r.length<s.length){for(let e=r.length;e<s.length;e++)r.push(Array(r[0].length).fill(!0));b.update(r)}}else r.push(Array(s.length).fill(!0)),b.update(r)}x(),v()},getParts:()=>s,getSequence:()=>r}}(w,I),w.fio=new function(e){function t(t){e.composition.load(t),e.melody.load(t),t.controls&&e.controls.load(t.controls)}function l(t,l){if(t||(t=e.composition.get()),0===t.parts.length){if(!confirm("No melody, continue save?"))return}l||(l=e.controls.get()),localStorage.setItem("comp",JSON.stringify({...t,controls:l}))}function n(){const t=localStorage.getItem("comp");if(t&&"undefined"!==t){const l=JSON.parse(t);e.composition.load(l),e.melody.load(l),e.controls.load(l.controls)}}function a(){e.melody.clear(),localStorage.setItem("comp","")}function o(){if(e.composition.isRecording())return;e.composition.update();const t=localStorage.getItem("comp"),l=new Blob([t],{type:"application/x-download;charset=utf-8"}),n=prompt("Name composition",e.composition.get().title);n&&(saveAs(l,n+".json"),e.ui.faces.title.update(n))}function c(t,l,n){new Midi.fromUrl(n).then((t=>{t.tracks.forEach((t=>{const l=t.notes;for(let t=0;t<l.length;t++){const{name:n,duration:a,time:o}=l[t];let c=n,i=t===l.length-1;if(t>0){const n=l[t-1];let a=o-(n.time+n.duration);a>0&&e.composition.addNote("rest",Tone.Time(a).toNotation(),i)}e.composition.addNote(c,Tone.Time(a).toNotation(),i)}}))}))}return{connect:function(){e.ui.getPanel("fio",{label:"Files IO"}),e.ui.addCallbacks([{callback:l,key:"s",text:"Save Local"},{callback:o,key:"alt-s",text:"Save File"},{callback:n,key:"l",text:"Load Local"},{type:"UIFile",callback:t,key:"o",text:"Load File",promptDefault:"compositions"},{callback:a,text:"Clear Local"},{type:"UIFile",callback:c,text:"Load Midi",promptDefault:"compositions",fileType:"audio/midi"}])},saveLocal:l}}(w),w.score=new function(t){let l;const n=document.createElement("canvas");let a;if(!n.getContext("2d"))return;a=n.getContext("2d");let o=20,c=12,i="CDEFGAB".split(""),s=["F","C","G","D","A","E","B"],r=["B","E","A","D","G","C","F"],u={G:["#",1],D:["#",2],A:["#",3],E:["#",4],B:["#",5],"F#":["#",6],"C#":["#",7],F:["b",1],Bb:["b",2],Eb:["b",3],Ab:["b",4],Db:["b",5],Gb:["b",6],Cb:["b",7]},d={A:"C",E:"G",B:"D","F#":"A","C#":"E","G#":"B",Eb:"Gb","D#":"F#",Bb:"Db",F:"Ab",C:"Eb",G:"Bb",D:"F"},p=["G","F","E","D","C","B","A"],f=!1;function b(e,t,l,n){a.beginPath(),a.moveTo(e,t),a.lineTo(l,n),a.stroke()}function g(e,t){let l=e[0],n=+e[e.length-1],a=t[0],o=+t[t.length-1];return i.indexOf(l)-i.indexOf(a)+7*(n-o)}function h(i){let{width:f,height:h}=l.el.getBoundingClientRect();const{tonic:k,scale:m}=t.composition.get(),y=e.indexOf(k),x=m.map((t=>{let l=e[y+t];return l.substring(0,l.length-1)}));let v=k.substring(0,k.length-1);m.includes(3)&&!m.includes(4)&&(v=d[v]);let w=[];if(u[v]){let e=u[v];w="#"===e[0]?s.slice(0,e[1]):r.slice(0,e[1])}let I=16,C=32+w.length*I,P=C,S=o,U=f-8-C-20,L=0===i.length?4:Math.max(...i.flatMap((e=>e.melody.map((e=>+e[1][0]))))),M=Math.max(...i.map((e=>e.melody.length))),T=Math.ceil(M/L),E=i.flatMap((e=>e.melody)).map(((e,t)=>[e[0]?e[0].substring(0,e[0].length-1):null,Math.floor(t%M/L)])).filter((e=>null!==e[0])).filter((e=>!x.includes(e[0]))),D=E.length,R=[];for(let e=0;e<T;e++)R[e]=E.filter((t=>t[1]===e)).length;let A=1,N=1+T+T*L+D,O=[N];if(U>M*I+T*I+D*I)I=Math.floor(U/N);else{O=[0];for(let e=0;e<T;e++){let t=L+R[e]+1,l=t*I;O[A-1]*I+l<U?O[A-1]+=t:(A++,O.push(t))}}n.width=f-8,n.height=144*A+40,a.fillStyle="lightgray",a.fillRect(0,0,n.width,n.height),a.fillStyle="black",a.strokeStyle="black";for(let e=0;e<A;e++){let t=o+144*e,l=32;a.strokeStyle="gray";for(let e=0;e<11;e++){let l=o+e*c+c;5!==e&&b(10,t+l,f-10-8,t+l)}a.fillStyle="black",a.font="60px serif",a.fillText("ð„ž",10,t+o+54),a.font="36px serif",a.fillText("ð„¢",10,t+o+114),a.font="18px serif",w.forEach((e=>{let n=32+t+6*p.indexOf(e);a.fillText("â™¯",l,n),a.fillText("â™¯",l,n+84),l+=16}))}if(0===i.length)return;let B=P+I,F=0,G=0,q=0,W=O[q];for(let e=0;e<=M;e++){let t=I;if(q<A-1&&(t=Math.floor(U/O[q])),e===M){a.fillStyle="black",a.fillRect(B-t/2,S+o+c,6,48),a.fillRect(B-t/2,S+o+84,6,48);continue}if(e>0&&e+G>W-1&&(q++,S+=144,B=P+I,W+=O[q]),e===M){a.fillStyle="black",a.fillRect(B,S+o+c,6,48),a.fillRect(B,S+o+84,6,48);continue}let l=[],n=[];for(let t=0;t<i.length;t++){let{startDelay:a,startIndex:o,doubler:c,repeat:s,melody:r}=i[t],u=(e-a+o)%r.length;r[u]&&(l.push(r[u]),n.push(r.slice(u-F,u+(L-F))))}if(l.every((e=>null===e[0]))){let e=!1;if(a.font="26px Noto",n.flatMap((e=>e)).every((e=>null===e[0]))&&(a.fillText("ð„»",B+t,S+132),e=!0),n.forEach((t=>{t.forEach(((t,l)=>{l<F&&l+L/parseInt(t[1])>F&&(e=!0)}))})),!e){let e=L/4*2,l=F%e,o=F>=e?1:0,c=n.map((t=>t.slice(e*o,e+e*o)));c.flatMap((e=>e)).every((e=>null===e[0]))?0===l&&a.fillText("ð„¼",B+t,S+132):l%2==0?c.filter((e=>e[l+1])).every((e=>null===e[l+1][0]))?a.fillText("ð„½",B+t/2,S+138):a.fillText("ð„¾",B,S+138):c.filter((e=>e[l-1])).every((e=>null!==e[l-1][0]))&&a.fillText("ð„¾",B,S+138)}F++}else a.strokeStyle="black",l.forEach((e=>{let[l,c]=e;if(null===l)return;let i=o+S+72+6*g("C4",l),s=l.substring(0,l.length-1);if(x.includes(s)||(a.font="18px sans-serif",l.includes("#")?a.fillText("â™¯",B-t/2,i+8):a.fillText("â™®",B-t/2,i+8),B+=t,G++),"1n"===c&&(a.beginPath(),a.ellipse(B,i,5,3,-Math.PI/6,0,2*Math.PI),a.stroke()),"2n"===c&&(a.beginPath(),a.ellipse(B,i,5,3,-Math.PI/6,0,2*Math.PI),a.stroke(),b(B+5,i-1,B+5,i-24)),"4n"===c&&(a.beginPath(),a.ellipse(B,i,6,4,-Math.PI/6,0,2*Math.PI),a.fill(),b(B+5,i-1,B+5,i-24)),"8n"===c){let e=L/4*2,o=F%e,c=F>=e?1:0,s=n.map((t=>t.slice(e*c,e+e*c))),r=72+6*g("C4",l),u=0;for(let l=0;l<e;l++){let e=s.filter((e=>e[l])).map((e=>e[l]));if(l>o&&(e.every((e=>null===e[0]))||e.every((e=>"8n"!==e[1]))))break;e.every((e=>null===e[0]))||(l>o&&(u+=t),e.forEach((e=>{if(null===e[0])return;let t=72+6*g("C4",e[0]);t<r&&(r=t)})))}let d=!1;u>0?a.fillRect(B+5,S+r-6,u,4):d=s.filter((e=>e[o-1])).every((e=>null===e[o-1][0])),b(B+5,i-1,B+5,S+r-6),a.beginPath(),a.ellipse(B,i,6,4,-Math.PI/6,0,2*Math.PI),a.fill(),d&&b(B+5,S+r-6,B+10,S+r+6)}S>80&&S<104&&b(B-12,S+o+72,B+12,S+o+72)})),F++;if(F===L){B+=t,G++;let e=B;a.strokeStyle="black",b(e+t/2,S+o+c,e+t/2,S+o+60),b(e+t/2,S+o+84,e+t/2,S+o+132),F=0}B+=t}}return new FontFace("Noto","url(https://fonts.gstatic.com/s/notomusic/v14/pe0rMIiSN5pO63htf1sxEkW7I9tAcVwo.woff2)").load().then((e=>{document.fonts.add(e),console.log("Font loaded"),f=!0})),{connect:function(){l=t.ui.getPanel("score"),l.el.appendChild(n)},update:function(e){h(e)},draw:h}}(w),w.ui=n(w,{useMain:!0}),w.ui.setup(),w.fio.connect(),w.composition.connect(),w.melody.connect(),w.playback.connect(),w.score.connect(),w.controls.connect(),w.ui.settings=a(w,{name:"doodoo",workspaceFields:["noteWidth"],workspaces:[{text:"Default",url:"workspaces/Default.json"}]}),w.ui.settings.load(),w.composition.load({}),w.controls.load(),w.score.draw([])}();
//# sourceMappingURL=src_maps/composer.min.js.map
